version: "3.9"

services:
  data-lab:
    build:
      context: .
      dockerfile: dev/base/Dockerfile   # Single container image with all stacks
    image: data-lab:latest
    container_name: data-lab
    user: root
    working_dir: /home/datalab
    env_file:
      - .env.example
    volumes:
      - ./app:/home/datalab/app
      - ./python:/home/datalab/python
      - ./spark:/home/datalab/spark
      - ./airflow:/home/datalab/airflow
      - ./dbt:/home/datalab/dbt
      - ./terraform:/home/datalab/terraform
      - ./scala:/home/datalab/scala
      - ./java:/home/datalab/java
      - ./hive:/home/datalab/hive
      - ./hadoop:/home/datalab/hadoop
      - ./kafka:/home/datalab/kafka
      - ./hudi:/home/datalab/hudi
      - ./iceberg:/home/datalab/iceberg
      - ./delta:/home/datalab/delta
      - ./runtime:/home/datalab/runtime
    ports:
      - "8080:8080"   # Airflow or other UI
      - "4040:4040"   # Spark UI
      - "9090:9090"   # Spark master UI
      - "18080:18080" # Spark history server
      - "9092:9092"   # Kafka broker
      - "9870:9870"   # Hadoop NameNode UI
      - "8088:8088"   # YARN ResourceManager UI
      - "10000:10000" # HiveServer2 JDBC
    tty: true
    command: ["sleep", "infinity"]
